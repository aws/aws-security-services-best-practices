
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="AWS">
      
      
        <link rel="canonical" href="https://aws.github.io/aws-security-services-best-practices/guides/waf/configuring-waf-rules/docs/">
      
      
        <link rel="prev" href="../../prerequisites/docs/">
      
      
        <link rel="next" href="../../monitoring-waf-rules/docs/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Configuring WAF Rules - AWS Security Services Best Practices</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    

<script>
  (function(n,i,v,r,s,c,x,z){x=window.AwsRumClient={q:[],n:n,i:i,v:v,r:r,c:c};window[n]=function(c,p){x.q.push({c:c,p:p});};z=document.createElement('script');z.async=true;z.src=s;document.head.insertBefore(z,document.head.getElementsByTagName('script')[0]);})(
    'cwr',
    'de3746ff-7a70-4809-9b1e-3a49496628c6',
    '1.0.0',
    'us-east-1',
    'https://client.rum.us-east-1.amazonaws.com/1.15.0/cwr.js',
    {
      sessionSampleRate: 1,
      guestRoleArn: "arn:aws:iam::655298983051:role/RUM-Monitor-us-east-1-655298983051-6113407803071-Unauth",
      identityPoolId: "us-east-1:1d4fcb9f-2a3b-478f-b13a-a7019ac15d61",
      endpoint: "https://dataplane.rum.us-east-1.amazonaws.com",
      telemetries: ["performance","errors","http"],
      allowCookies: false,
      enableXRay: false
    }
  );
</script>


  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#configuring-waf-rules" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="AWS Security Services Best Practices" class="md-header__button md-logo" aria-label="AWS Security Services Best Practices" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AWS Security Services Best Practices
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Configuring WAF Rules
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/aws/aws-security-services-best-practices" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-security-services-best-practices
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="AWS Security Services Best Practices" class="md-nav__button md-logo" aria-label="AWS Security Services Best Practices" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    AWS Security Services Best Practices
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aws/aws-security-services-best-practices" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-security-services-best-practices
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../certificate-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon Certificate Services Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../detective/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon Detective Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guardduty/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon GuardDuty Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../inspector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon Inspector Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../macie/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon Macie Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security-hub/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS Security Hub Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security-lake/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon Security Lake Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    AWS WAF Best Practices
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            AWS WAF Best Practices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prerequisites/docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WAF Prerequisites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Configuring WAF Rules
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Configuring WAF Rules
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#understanding-terminating-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding terminating actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-approach-for-selecting-rules" class="md-nav__link">
    <span class="md-ellipsis">
      General approach for selecting rules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General approach for selecting rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rules-toward-the-top" class="md-nav__link">
    <span class="md-ellipsis">
      Rules toward the top
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules-toward-the-middle" class="md-nav__link">
    <span class="md-ellipsis">
      Rules toward the middle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules-toward-the-bottom" class="md-nav__link">
    <span class="md-ellipsis">
      Rules toward the bottom
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-acl-capacity-units-wcu" class="md-nav__link">
    <span class="md-ellipsis">
      Web ACL capacity units (WCU)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#selecting-the-default-action-for-your-web-acl" class="md-nav__link">
    <span class="md-ellipsis">
      Selecting the default action for your web ACL
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-based-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Rate-based rules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-rule-labels" class="md-nav__link">
    <span class="md-ellipsis">
      Using rule labels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-managed-rule-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Using managed rule groups
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using managed rule groups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#managed-rule-group-providers" class="md-nav__link">
    <span class="md-ellipsis">
      Managed rule group providers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#versioning" class="md-nav__link">
    <span class="md-ellipsis">
      Versioning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scope-down-statements" class="md-nav__link">
    <span class="md-ellipsis">
      Scope-down statements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-false-positives" class="md-nav__link">
    <span class="md-ellipsis">
      Handling false positives
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-large-http-requests" class="md-nav__link">
    <span class="md-ellipsis">
      Handling large HTTP requests
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitoring-waf-rules/docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring WAF Rules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../using-waf-with-other-services/docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using WAF with other AWS Services
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../network-firewall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS Network Firewall Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dns-firewall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon Route 53 Resolver DNS Firewall Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../contributors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributors
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#understanding-terminating-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding terminating actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-approach-for-selecting-rules" class="md-nav__link">
    <span class="md-ellipsis">
      General approach for selecting rules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="General approach for selecting rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rules-toward-the-top" class="md-nav__link">
    <span class="md-ellipsis">
      Rules toward the top
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules-toward-the-middle" class="md-nav__link">
    <span class="md-ellipsis">
      Rules toward the middle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules-toward-the-bottom" class="md-nav__link">
    <span class="md-ellipsis">
      Rules toward the bottom
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-acl-capacity-units-wcu" class="md-nav__link">
    <span class="md-ellipsis">
      Web ACL capacity units (WCU)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#selecting-the-default-action-for-your-web-acl" class="md-nav__link">
    <span class="md-ellipsis">
      Selecting the default action for your web ACL
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-based-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Rate-based rules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-rule-labels" class="md-nav__link">
    <span class="md-ellipsis">
      Using rule labels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-managed-rule-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Using managed rule groups
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using managed rule groups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#managed-rule-group-providers" class="md-nav__link">
    <span class="md-ellipsis">
      Managed rule group providers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#versioning" class="md-nav__link">
    <span class="md-ellipsis">
      Versioning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scope-down-statements" class="md-nav__link">
    <span class="md-ellipsis">
      Scope-down statements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-false-positives" class="md-nav__link">
    <span class="md-ellipsis">
      Handling false positives
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-large-http-requests" class="md-nav__link">
    <span class="md-ellipsis">
      Handling large HTTP requests
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="configuring-waf-rules">Configuring WAF Rules</h1>
<h2 id="understanding-terminating-actions">Understanding terminating actions</h2>
<p>One of the most important concepts to understand is that <em>Allow</em> and <em>Block</em> are <a href="https://docs.aws.amazon.com/waf/latest/developerguide/web-acl-rule-actions.html">terminating actions</a>. When a rule matches and has one of these actions, no more rules are evaluated. Be cautious when using the <em>Allow</em> action, especially near the top of your web ACL. A rule with the <em>Allow</em> action will allow a request even if a subsequent rule would have blocked it (a false negative).</p>
<h2 id="general-approach-for-selecting-rules">General approach for selecting rules</h2>
<p>This section outlines a general thought process for selecting WAF rules. Assuming your web ACL's default action is <em>Allow</em>, it makes sense to block as many unwanted requests as possible near the top of the web ACL. Put rules toward the top that apply to the widest range of unwanted traffic. Put rules toward the end that have narrow criteria or have per-request charges. Rather than prescribing an exact ordering of rules, they are grouped into top, middle, and bottom categories.</p>
<h3 id="rules-toward-the-top">Rules toward the top</h3>
<ul>
<li><a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-rule-statement-type-rate-based.html">Rate-based rules</a> for blocking request floods</li>
<li><a href="https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-ip-rep.html#aws-managed-rule-groups-ip-rep-amazon">Amazon IP reputation list</a> managed rule group</li>
<li><a href="https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-ip-rep.html#aws-managed-rule-groups-ip-rep-anonymous">Anonymous IP list</a> managed rule group</li>
<li><a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-rule-statement-type-geo-match.html">Geographic-based rules</a> for blocking or rate-limiting requests based on region of origin</li>
</ul>
<h3 id="rules-toward-the-middle">Rules toward the middle</h3>
<ul>
<li>Custom rules that validate expected HTTP request fields (user agents, headers)</li>
<li><a href="https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-baseline.html#aws-managed-rule-groups-baseline-crs">AWS Core rule set</a> to block OWASP Top 10 threats</li>
<li><a href="https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-use-case.html#aws-managed-rule-groups-use-case-sql-db">SQL database</a> managed rule group (only for applications that use SQL)</li>
<li><a href="https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-baseline.html#aws-managed-rule-groups-baseline-known-bad-inputs">Known bad inputs</a> managed rule group (only for applications that use Java)</li>
</ul>
<h3 id="rules-toward-the-bottom">Rules toward the bottom</h3>
<ul>
<li><a href="https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-bot.html">Bot Control</a> rule group (with scope-down statement to limit applicability)</li>
<li><a href="https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-atp.html">Fraud Control account takeover prevention</a> rule group (with scope-down statement to limit applicability)</li>
</ul>
<h2 id="web-acl-capacity-units-wcu">Web ACL capacity units (WCU)</h2>
<p>Each web ACL has a capacity measured in <a href="https://docs.aws.amazon.com/waf/latest/developerguide/aws-waf-capacity-units.html">web ACL capacity units</a> (WCU). This capacity is used by rules and rule groups you add to the web ACL. By default the capacity is 1,500 WCU.</p>
<p>To avoid unecessarily reaching this limit, make sure the web ACL only includes rules that are required by the protected applications. You can now use up to 5,000 WCU per web ACL without requesting a limit increase, but there are additional charges that come into play.</p>
<h2 id="selecting-the-default-action-for-your-web-acl">Selecting the default action for your web ACL</h2>
<p>If there are no matching rules in the web ACL that have a terminating action, the web ACL applies a <a href="https://docs.aws.amazon.com/waf/latest/developerguide/web-acl-default-action.html">default action</a>. There are two possible default actions: <em>Allow</em> and <em>Block</em>. Most customers set the default action to <em>Allow</em>.</p>
<p>If you want to allow most requests and only block attackers, use the <em>Allow</em> default action. For example, you might only want to block requests with malicious fields or that originate from an untrusted source IP or geography.</p>
<p>If you want to allow specific requests and block everything else, use the <em>Block</em> default action. For example, you might only want to allow requests from a specific IP range or requests that contain specific values.</p>
<h2 id="rate-based-rules">Rate-based rules</h2>
<p>WAF <a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-rule-statement-type-rate-based.html">rate-based rules</a> count requests from up to 10,000 source IPs (per rate-based rule) and block requests when a client exceeds a threshold measured over a trailing 5-minute window. This is an often overlooked feature of AWS WAF, yet it's one of the most simple and valuable rules you can add to web ACLs. A majority of customers should have at least one rate-based rule in every web ACL.</p>
<p>See the blog <a href="https://aws.amazon.com/blogs/security/three-most-important-aws-waf-rate-based-rules/">The three most important AWS WAF rate-based rules</a> for a full explanation of how to leverage rate-based rules. In summary, the three most important rate-based rules are:</p>
<ol>
<li>A blanket rate-based rule that applies to all requests.</li>
<li>URI-specific rate-based rules to protect specific parts of an application with more restrictive limits.</li>
<li>Rate-based rules that limit the rate of requests from known malicious source IPs.</li>
</ol>
<p>AWS Shield Advanced provides DDoS cost protection to safeguard against scaling charges resulting from DDoS-related usage spikes on ALBs and CloudFront distributions protected by Shield Advanced. You can <a href="https://docs.aws.amazon.com/waf/latest/developerguide/request-refund.html">request a credit</a> for charges through AWS Support. To be eligible to receive a credit for CloudFront and ALB protected resources, you must have associated an AWS WAF web ACL and implemented a rate-based rule in the web ACL.</p>
<h2 id="using-rule-labels">Using rule labels</h2>
<p>A <a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-labels.html">label</a> is metadata added to a web request by a matching rule. Use labels to make the results of one rule available to other rules. Labels can be inspected by other rules lower (not above) in the same web ACL by using the <a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-rule-statement-type-label-match.html">label match statement</a>.</p>
<p>Labels added by rules with terminating actions cannot be inspected by other rules. These labels are included in <a href="https://docs.aws.amazon.com/waf/latest/developerguide/logging-fields.html">WAF log records</a> and <a href="https://docs.aws.amazon.com/waf/latest/developerguide/monitoring-cloudwatch.html#waf-metrics">CloudWatch metric dimensions</a> so you can analyze and visualize the behavior of terminating rules.</p>
<p>Labels are commonly used to augment the behavior of a managed rule. The first step is to switch the managed rule's action from <em>Block</em> to <em>Count</em>. Then create another rule below that matches on managed rule's label along with other conditions that determine if the request should be blocked.</p>
<p>See <a href="https://aws.amazon.com/blogs/security/how-to-customize-behavior-of-aws-managed-rules-for-aws-waf/">How to customize behavior of AWS Managed Rules for AWS WAF</a> for more information on using labels.</p>
<h2 id="using-managed-rule-groups">Using managed rule groups</h2>
<h3 id="managed-rule-group-providers">Managed rule group providers</h3>
<p><a href="https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups.html">AWS managed rule groups</a> are maintained by Amazon's threat research team. These rules do not have a per-request fee, with the exception of Bot Control and Fraud Control rule groups. See above for a recommendation on which AWS managed rule groups are suitable for most customers.</p>
<p>You can subscribe to <a href="https://docs.aws.amazon.com/waf/latest/developerguide/marketplace-managed-rule-groups.html">managed rules provided by AWS partners</a> using AWS Marketplace. These rule groups run in your WAF web ACL, but there are additional fees that come into play.</p>
<p>To use an AWS Marketplace rule group in a Firewall Manager policy, each account in your organization must first subscribe to that rule group.</p>
<h3 id="versioning">Versioning</h3>
<p>A managed rule group provider might need to update their rules. For rule groups that support <a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-managed-rule-groups-versioning.html">versioning</a>, you can choose to let the provider manage which version you use (default) or you can manage the version setting yourself (static).</p>
<p>When using the default version, <a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-using-managed-rule-groups-sns-topic.html">subscribe to notifications</a> of new versions. This informs you about upcoming changes to give you time to test them before they become the new default.</p>
<p>When using a static version, it's also important to subscribe to notifications so you are aware of new static versions. Keep your version up to date to ensure your applications have the most current protections. <a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-using-managed-rule-groups-expiration.html">Track version expiration</a> to make sure you aren't forced to upgrade before you test.</p>
<p>See <a href="https://aws.amazon.com/blogs/security/how-to-customize-behavior-of-aws-managed-rules-for-aws-waf/">How to customize behavior of AWS Managed Rules for AWS WAF</a> for more information on version management.</p>
<p>The AWS-managed <a href="https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-ip-rep.html">IP reputation rule groups</a> do not use versions. These rule groups are updated frequently based on the evolution of Amazon threat intelligence.</p>
<h3 id="scope-down-statements">Scope-down statements</h3>
<p>A <a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-rule-scope-down-statements.html">scope-down statement</a> is a statement that you add inside a managed rule group or a rate-based rule to narrow the set of requests that are evaluated.</p>
<p>Use scope-down statements on advanced managed rule groups like Bot Control and Fraud Protection to specify which requests should be evaluated by the rule group. This is an effective way of optimizing your cost since you will not be charged for requests that are excluded by the scope-down statement.</p>
<p>See <a href="https://aws.amazon.com/blogs/security/how-to-customize-behavior-of-aws-managed-rules-for-aws-waf/">How to customize behavior of AWS Managed Rules for AWS WAF</a> for more information on scope-down statements.</p>
<h3 id="handling-false-positives">Handling false positives</h3>
<p>WAF rules are often looking for patterns that occur in HTTP request fields to determine if the request is malicious. Due to the infinite variety of data that might appear in HTTP requests, there are times when a WAF rule blocks a request that is not malicious. This is known as a false positive.</p>
<p>To determine which rule is causing false positives, query your WAF logs to identify the label of the rule that blocked the request. Since this rule is incorrectly blocking requests, your instinct might be to write a rule that allows these requests. That turns out to be problematic because <em>Allow</em> is a terminating action, and your rule might allow requests that should have been blocked for other reasons.</p>
<p>Follow these two steps to correct false positives caused by a managed rule. As an example, suppose the <code>Log4JRCE_BODY</code> rule inside the AWS managed rule group for <a href="https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-baseline.html#aws-managed-rule-groups-baseline-known-bad-inputs">Known bad inputs</a> is causing false positives for the URI <code>/reports</code>.</p>
<ol>
<li>Switch the action for <code>Log4JRCE_BODY</code> from <em>Block</em> to <em>Count</em>. Requests matched by this rule will be labeled with <code>awswaf:managed:aws:known-bad-inputs:Log4JRCE_Body</code>.</li>
<li>Write a rule below the managed rule group that has this behavior:</li>
</ol>
<pre><code>IF Label = awswaf:managed:aws:known-bad-inputs:Log4JRCE_Body AND
   URI != &quot;/reports&quot;
THEN Block
</code></pre>
<p>Keep in mind that if you put a managed rule in <em>Count</em> mode then you must write a corresponding rule that blocks requests labeled by the managed rule. Otherwise, you will end up with false negatives.</p>
<p>See <a href="https://aws.amazon.com/blogs/security/how-to-customize-behavior-of-aws-managed-rules-for-aws-waf/">How to customize behavior of AWS Managed Rules for AWS WAF</a> for more information on handling false positives.</p>
<h2 id="handling-large-http-requests">Handling large HTTP requests</h2>
<p>AWS WAF has limits on the size and number of HTTP request components it can inspect. See <a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-oversize-request-components.html">Handling oversize web request components in AWS WAF</a> for more details. Here is a summary of the size limits.</p>
<ul>
<li>AWS WAF can inspect request bodies up to 64 KB for CloudFront web ACLs. For regional web ACLs, AWS WAF can inspect bodies up to 8 KB.</li>
<li>For all web ACLs, AWS WAF can inspect 8 KB of headers or cookies or the first 200 headers or cookies, whichever limit comes first.</li>
</ul>
<p>If you need to allow some oversized requests, add rules to explicitly <em>Allow</em> only those requests. Prioritize those rules so that they run before any other rules in the web ACL that inspect the same components. Here is an example that allows oversized requests only for a specific URI and HTTP method.</p>
<pre><code>IF Body size &gt; 8,192 (with oversize handling set to Match) AND
   URI path starts with &quot;/upload&quot; AND
   HTTP method exactly matches &quot;POST&quot;
THEN Allow
</code></pre>
<p>For all other requests, add a rule to inspect components with size limits and <em>Block</em> requests that go over the limit. This prevents non-inspected request content from reaching your application.</p>
<pre><code>IF Body size &gt; 8,192 (with oversize handling set to Match) OR
   All headers size &gt; 8,192 (with oversize handling set to Match)
THEN Block
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; Amazon 2023
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["tabs", "content.code.copy", "announce.dismiss", "header.autohide"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>