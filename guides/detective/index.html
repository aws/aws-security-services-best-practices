
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="AWS">
      
      
        <link rel="canonical" href="https://aws.github.io/aws-security-services-best-practices/guides/detective/">
      
      
        <link rel="prev" href="../certificate-services/">
      
      
        <link rel="next" href="../guardduty/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Amazon Detective Best Practices - AWS Security Services Best Practices</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    

<script>
  (function(n,i,v,r,s,c,x,z){x=window.AwsRumClient={q:[],n:n,i:i,v:v,r:r,c:c};window[n]=function(c,p){x.q.push({c:c,p:p});};z=document.createElement('script');z.async=true;z.src=s;document.head.insertBefore(z,document.head.getElementsByTagName('script')[0]);})(
    'cwr',
    'de3746ff-7a70-4809-9b1e-3a49496628c6',
    '1.0.0',
    'us-east-1',
    'https://client.rum.us-east-1.amazonaws.com/1.15.0/cwr.js',
    {
      sessionSampleRate: 1,
      guestRoleArn: "arn:aws:iam::655298983051:role/RUM-Monitor-us-east-1-655298983051-6113407803071-Unauth",
      identityPoolId: "us-east-1:1d4fcb9f-2a3b-478f-b13a-a7019ac15d61",
      endpoint: "https://dataplane.rum.us-east-1.amazonaws.com",
      telemetries: ["performance","errors","http"],
      allowCookies: false,
      enableXRay: false
    }
  );
</script>


  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#amazon-detective" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="AWS Security Services Best Practices" class="md-header__button md-logo" aria-label="AWS Security Services Best Practices" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AWS Security Services Best Practices
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Amazon Detective Best Practices
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/aws/aws-security-services-best-practices" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-security-services-best-practices
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="AWS Security Services Best Practices" class="md-nav__button md-logo" aria-label="AWS Security Services Best Practices" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    AWS Security Services Best Practices
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aws/aws-security-services-best-practices" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-security-services-best-practices
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificate-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon Certificate Services Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Amazon Detective Best Practices
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Amazon Detective Best Practices
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-this-guide" class="md-nav__link">
    <span class="md-ellipsis">
      How to use this guide
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-amazon-detective" class="md-nav__link">
    <span class="md-ellipsis">
      What is Amazon Detective?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#who-is-amazon-detective-for" class="md-nav__link">
    <span class="md-ellipsis">
      Who is Amazon Detective for?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-are-the-benefits-of-enabling-amazon-detective" class="md-nav__link">
    <span class="md-ellipsis">
      What are the benefits of enabling Amazon Detective?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting started
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Getting started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-guardduty" class="md-nav__link">
    <span class="md-ellipsis">
      Enable GuardDuty
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where-to-enable-detective" class="md-nav__link">
    <span class="md-ellipsis">
      Where to enable Detective
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#region-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Region Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enablement" class="md-nav__link">
    <span class="md-ellipsis">
      Enablement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enroll-other-aws-accounts-in-your-organization" class="md-nav__link">
    <span class="md-ellipsis">
      Enroll other AWS Accounts in your Organization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-optional-data-feeds" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Optional Data Feeds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-amazon-security-lake-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Amazon Security Lake integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operationalizing" class="md-nav__link">
    <span class="md-ellipsis">
      Operationalizing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Operationalizing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#providing-access" class="md-nav__link">
    <span class="md-ellipsis">
      Providing Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#investigating-a-finding" class="md-nav__link">
    <span class="md-ellipsis">
      Investigating a Finding
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Investigating a Finding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#start-your-investigation-from-guardduty" class="md-nav__link">
    <span class="md-ellipsis">
      Start your investigation from GuardDuty
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-your-investigation-from-a-finding-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Start your investigation from a Finding Groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#threat-hunting-in-detective" class="md-nav__link">
    <span class="md-ellipsis">
      Threat Hunting in Detective
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crafting-detective-embedded-urls" class="md-nav__link">
    <span class="md-ellipsis">
      Crafting Detective Embedded URLs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cost-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Cost Considerations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workshops" class="md-nav__link">
    <span class="md-ellipsis">
      Workshops
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#videos" class="md-nav__link">
    <span class="md-ellipsis">
      Videos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blogs" class="md-nav__link">
    <span class="md-ellipsis">
      Blogs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../guardduty/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon GuardDuty Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../inspector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon Inspector Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../macie/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon Macie Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../security-hub/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS Security Hub Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../security-lake/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon Security Lake Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    AWS WAF Best Practices
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            AWS WAF Best Practices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../waf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../waf/prerequisites/docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WAF Prerequisites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../waf/configuring-waf-rules/docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuring WAF Rules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../waf/monitoring-waf-rules/docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring WAF Rules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../waf/using-waf-with-other-services/docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using WAF with other AWS Services
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../network-firewall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS Network Firewall Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../dns-firewall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon Route 53 Resolver DNS Firewall Best Practices
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributors
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-this-guide" class="md-nav__link">
    <span class="md-ellipsis">
      How to use this guide
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-amazon-detective" class="md-nav__link">
    <span class="md-ellipsis">
      What is Amazon Detective?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#who-is-amazon-detective-for" class="md-nav__link">
    <span class="md-ellipsis">
      Who is Amazon Detective for?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-are-the-benefits-of-enabling-amazon-detective" class="md-nav__link">
    <span class="md-ellipsis">
      What are the benefits of enabling Amazon Detective?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting started
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Getting started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-guardduty" class="md-nav__link">
    <span class="md-ellipsis">
      Enable GuardDuty
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#where-to-enable-detective" class="md-nav__link">
    <span class="md-ellipsis">
      Where to enable Detective
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#region-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Region Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enablement" class="md-nav__link">
    <span class="md-ellipsis">
      Enablement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enroll-other-aws-accounts-in-your-organization" class="md-nav__link">
    <span class="md-ellipsis">
      Enroll other AWS Accounts in your Organization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-optional-data-feeds" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Optional Data Feeds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-amazon-security-lake-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Amazon Security Lake integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operationalizing" class="md-nav__link">
    <span class="md-ellipsis">
      Operationalizing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Operationalizing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#providing-access" class="md-nav__link">
    <span class="md-ellipsis">
      Providing Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#investigating-a-finding" class="md-nav__link">
    <span class="md-ellipsis">
      Investigating a Finding
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Investigating a Finding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#start-your-investigation-from-guardduty" class="md-nav__link">
    <span class="md-ellipsis">
      Start your investigation from GuardDuty
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-your-investigation-from-a-finding-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Start your investigation from a Finding Groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#threat-hunting-in-detective" class="md-nav__link">
    <span class="md-ellipsis">
      Threat Hunting in Detective
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crafting-detective-embedded-urls" class="md-nav__link">
    <span class="md-ellipsis">
      Crafting Detective Embedded URLs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cost-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Cost Considerations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workshops" class="md-nav__link">
    <span class="md-ellipsis">
      Workshops
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#videos" class="md-nav__link">
    <span class="md-ellipsis">
      Videos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blogs" class="md-nav__link">
    <span class="md-ellipsis">
      Blogs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="amazon-detective">Amazon Detective</h1>
<h2 id="introduction">Introduction</h2>
<p>Welcome to the Amazon Detective Hub Best Practices Guide. The purpose of this guide is to provide prescriptive guidance for leveraging Amazon Detective for investigating security issues associated with your AWS resources. Publishing this guidance via GitHub will allow for quick iterations to enable timely recommendations that include service enhancements, as well as the feedback from the user community. This guide is designed to provide value whether you are deploying Detective for the first time in a single account, or looking for ways to optimize Detective in an existing multi-account deployment.</p>
<h2 id="how-to-use-this-guide">How to use this guide</h2>
<p>This guide is geared towards security practitioners who are responsible for monitoring and remediation of threats and malicious activity within AWS accounts (and resources). The best practices are organized into categories for easier consumption. Each category includes a set of corresponding best practices that begin with a brief overview, followed by detailed steps for implementing the guidance. The topics do not need to be read in a particular order:</p>
<ul>
<li><a href="#what-is-amazon-detective">What is Amazon Detective</a></li>
<li><a href="#who-is-amazon-detective-for">Who is Amazon Detective for</a></li>
<li><a href="#what-are-the-benefits-of-enabling-amazon-detective">What are the benefits of enabling Amazon Detective</a></li>
<li><a href="#getting-started">Getting started</a><ul>
<li><a href="#enable-guardduty">Enable GuardDuty</a></li>
<li><a href="#where-to-enable-detective">Where to enable Detective</a></li>
<li><a href="#region-considerations">Region considerations</a></li>
</ul>
</li>
<li><a href="#implementation">Implementation</a><ul>
<li><a href="#enablement">Enablement</a></li>
<li><a href="#enroll-other-aws-accounts-in-your-organization">Enroll other AWS account in your organization</a></li>
<li><a href="#enable-optional-data-feeds">Enable optional data feeds</a></li>
</ul>
</li>
<li><a href="#operationalizing">Operationalizing</a><ul>
<li><a href="#providing-access">Providing access</a></li>
<li><a href="#investigating-a-finding">Investigating a finding</a></li>
<li><a href="#start-your-investigation-from-guardduty">Start your investigation from GuardDuty</a></li>
<li><a href="#start-your-investigation-from-a-finding-groups">Start your investigation from a Finding Group</a></li>
<li><a href="#threat-hunting-in-detective">Threat hunting in Detective</a></li>
<li><a href="#crafting-detective-embedded-urls">Crafting Detective Embedded URLs</a></li>
</ul>
</li>
<li><a href="#cost-considerations">Cost Considerations</a></li>
<li><a href="#resources">Resources</a></li>
</ul>
<h2 id="what-is-amazon-detective">What is Amazon Detective?</h2>
<p>Amazon Detective makes it easy to analyze, investigate, and quickly identify the root cause of security findings or suspicious activities. Detective automatically collects log data from your AWS resources and uses machine learning, statistical analysis, and graph theory to help you visualize and conduct faster and more efficient security investigations.</p>
<h2 id="who-is-amazon-detective-for">Who is Amazon Detective for?</h2>
<p>Amazon Detective works well for customers who want to take advantage of a managed security service that helps connect the dots for investigating security issues in AWS. Many customers may be a bigger organization with many tools and want to enable analysts to quickly triage an incident. Other customers may have a leaner IT Security staff and need an effective tool to help their teams efficiently investigate security issues in AWS. Detective is for security analysts, security operations engineers, and incident response teams. Larger customers can benefit from using Amazon Detective if they have experienced tool sprawl and are looking to consolidate their SIEM tooling. Customers have particularly found value with Amazon Detective for telemetry and visibility into Amazon Elastic Kubernetes Service (EKS) clusters also, due to the tight integration of EKS audit logs and VPC flow logs.</p>
<h2 id="what-are-the-benefits-of-enabling-amazon-detective">What are the benefits of enabling Amazon Detective?</h2>
<p>Detective aids incident responders and security engineers in determining what resources are associated with a given security event. It uses data feeds from GuardDuty findings, VPC Flow Logs, CloudTrail, EKS audit logs, and Security Hub findings, to build a behavior graph to help customers understand resource associations, abnormal activity like newly observed geo locations, understanding when roles were assumed by other roles, along with many other use cases in your environment. Many customers may not have the log and telemetry collection correlation tooling built, or the knowledge or resources, and this makes Amazon Detective a perfect fit.</p>
<p>Many customers that have the tools, knowledge, and people already in place, are able to successfully navigate security events and discover related logs within an acceptable response time. Typically this requires third party tooling to be installed, configured, operated, and monitored to collect VPC Flow logs, CloudTrail logs, EKS Audit logs, and shipped to a log aggregation tool. Consider the cost tradeoff, and time saved, by using Amazon Detective where visibility into these data feeds is built-in vs aggregated and stored separately. Most customers have found Detective effective in shortening investigation times because they do not have to write queries into a log aggregation tool and instead rely on Detective provided insights.</p>
<p>Many customers observe that using Detective and GuardDuty together provides the ability to investigate natively in AWS after an event. GuardDuty tells you about the threat, but Detective tells you the story around that threat. Often we hear from customers that the amount of security findings from any given service overwhelm their teams and leave them without a clear priority. Detective enables teams to focus on true security events.</p>
<p>Detective is well suited Amazon EKS workloads to assist in runtime investigations. Detective allows you to view inside EKS workloads to examine pod configuration, pod image, image source, VPC flows within an EKS cluster, and activity by Kubernetes user within a cluster. If you run Amazon EKS across many AWS accounts, Detective’s ability to ingest data from the backend and centralize in a centralized Security Account helps reduce time to root cause during a security event. Take a closer look at our <a href="https://catalog.workshops.aws/containersecurity">Container Security Workshop</a> for more in-depth walkthroughs on how to use Detective for container based workloads.</p>
<h2 id="getting-started">Getting started</h2>
<h3 id="enable-guardduty">Enable GuardDuty</h3>
<p>Enabling Amazon GuardDuty is a pre-requisite before enabling Amazon Detective. Follow the <a href="https://docs.aws.amazon.com/guardduty/latest/ug/what-is-guardduty.html">Amazon GuardDuty documentation</a> for enabling GuardDuty and enrolling AWS Accounts in your Organization at scale.</p>
<p>If you run Amazon EKS in your environment, it is recommended to enable <a href="https://docs.aws.amazon.com/guardduty/latest/ug/kubernetes-protection.html">EKS Audit and Runtime Protection in GuardDuty</a>. In the enablement recommendations below we will discuss consuming EKS audit logs in Detective.</p>
<p>It’s recommended to update the GuardDuty CloudWatch Notification Frequency from its default of 6 hours to 15 minutes. If you leave it at 6 hours, it could take updates to recurring findings up to 6 hours to be reflected in Detective. Regardless if you do or do not change this frequency, new findings are always sent to Detective within five minutes of the finding being generated. Shortening this timeframe does not incur any additional costs.  For information about setting the notification frequency, see <a href="https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_findings_cloudwatch.html">Monitoring GuardDuty Findings with Amazon CloudWatch Events</a> in the Amazon GuardDuty User Guide.</p>
<h3 id="where-to-enable-detective">Where to enable Detective</h3>
<p>We recommend enabling Amazon Detective in the same Delegated Administrator AWS Account as the rest of your AWS Security Services (GuardDuty, Security Hub, Macie, etc), as outlined in the <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/security-reference-architecture/organizations.html">Security Reference Architecture</a> (SRA) whitepaper. If you don’t have a dedicated Security AWS Account yet, this is the perfect opportunity to create one. If you run AWS Control Tower, you already have one which is often called the “Audit” or “Security” Account.</p>
<p>Note that Detective currently supports a maximum of 1200 AWS accounts in each behavior graph. If you’re interested in enabling Detective for more than 1200 accounts please reach out to your AWS account team. For other Detective quotas refer to the documentation on <a href="https://docs.aws.amazon.com/detective/latest/adminguide/regions-limitations.html">regions and quotas</a>.</p>
<h3 id="region-considerations">Region Considerations</h3>
<p>Amazon Detective is a regional service. This means that to use Amazon Detective you will need to enable it in every region that you would like to have incident response capabilities with Detective.</p>
<p>A question that is often asked is “Should I use a security service in a region that my company is not actively using?” Detective’s costs are based on the amount of data ingested in a given account and region. If an AWS account or region has no activity, Detective will not incur a cost. It’s recommended to review the Usage section in Detective to determine if the estimated costs are acceptable. We recommend enabling Detective in every AWS account and region that you plan to make available in your AWS Organization. This ensures that if someone attempts to create resources in a region, you will have visibility if needed for any subsequent security issues.</p>
<p>You can use the AWS console, AWS CLI, or the Amazon Detective python scripts to enable Detective across accounts in an AWS Organization. <a href="https://docs.aws.amazon.com/detective/latest/adminguide/detective-github-scripts.html">Review the scripts and their contents here</a>.</p>
<h2 id="implementation">Implementation</h2>
<h3 id="enablement">Enablement</h3>
<p>To create a Delegated Administrator for Amazon Detective to your desired Security Tooling Account, follow the <a href="https://docs.aws.amazon.com/detective/latest/adminguide/accounts-designate-admin.html">enablement documentation</a>. Then, using your AWS console, open your Security Tooling account and browse to the Detective service.</p>
<p>Detective is very easy to enable. There is nothing to install and the integration with other AWS services is seamless. In the Detective service, enable Detective by clicking on the orange Get Started button.</p>
<p><img alt="Detective getting started" src="../../images/DT-Getting-Started.png" /></p>
<p><em>Figure 1: Detective getting started page</em></p>
<p>Review the service linked role that Detective will create to understand the permissions needed and then click enable Amazon Detective.</p>
<p><img alt="Detective Enablment" src="../../images/DT-Enable.png" /></p>
<p><em>Figure 2: Enable Detective</em></p>
<h3 id="enroll-other-aws-accounts-in-your-organization">Enroll other AWS Accounts in your Organization</h3>
<p>After enabling Detective you will need to enroll other AWS Accounts in the Organization. In the Detective console browse to Account Management. From the Account Management page you can enroll all accounts in your organization by selecting the “Enable all accounts“ button pictured below.</p>
<p><img alt="Enable all accounts" src="../../images/DT-Enable-All.png" /></p>
<p><em>Figure 3: Enable all Detective accounts</em></p>
<p>After you have enabled for all accounts in your organization ensure that you have turned on the "auto-enable" button as pictured below. This give the Detective delegated administrator the ability to automatically enable Detective in all new accounts that are created in your organization without needing to perform any actions by your team.</p>
<p><img alt="Detective auto enable" src="../../images/DT-Auto-Enable.png" /></p>
<p><em>Figure 4: Detective auto enable feature</em></p>
<h3 id="enable-optional-data-feeds">Enable Optional Data Feeds</h3>
<p>Browse to the General section.</p>
<p>If you have just enabled Detective, you will already be ingesting findings from AWS security services and EKS audit logs. If you were using Detective before these integrations were released you will need to enable them manually.</p>
<p><img alt="Update Source packages" src="../../images/DT-Sources.png" /></p>
<p><em>Figure 5: Detective source packages</em></p>
<h3 id="enable-amazon-security-lake-integration">Enable Amazon Security Lake integration</h3>
<p>Optionally, you can configure Detective to integrate with Amazon Security Lake to query and retrieve logs stored in Security Lake directly in the Detective console. With this integration, security analysts can start their security investigations based on summaries and visualizations in Detective. In the event they need to dive deeper and retrieve logs, Detective provides a pre-built query using Amazon Athena that is scoped to the time and entities under investigation. You can use this query to get a preview of CloudTrail or VPC flow logs that represent the potential security issue or download all the logs as CSV files.</p>
<p><img alt="SL Integration" src="../../images/DT-SL-Integration.png" />
<em>Figure 6: Security Lake integration enablement page</em></p>
<h2 id="operationalizing">Operationalizing</h2>
<h3 id="providing-access">Providing Access</h3>
<p>Amazon Detective works by consuming VPC Flow Logs, Cloudtrail Logs, EKS Audit Logs, and Security Hub findings and correlating resource IDs with events from GuardDuty into a behavior graph. This graph is what you can follow in Detective when performing an investigation to see which IP relates to which EC2 instance to which EC2 instance profile to which IAM role that created the instance profile, for example.</p>
<p><img alt="Detective flow" src="../../images/DT-Flow.png" /></p>
<p><em>Figure 7: Detective workflow diagram</em></p>
<p>As a result, there may be information being fed into Detective in the form of IP addresses, package vulnerabilities, IAM roles and federated users. You will want to apply least privilege to your Incident Investigator IAM Role.</p>
<p>Most customers will opt to provide access to their security and incident response teams to the Security Tooling account where many AWS Security Services including Security Hub, Inspector, Macie, and GuardDuty delegated administrators have been assigned. It’s best practice not to provide any team full administrative privileges to the AWS Account, and security teams are no different. We recommend granting incident responders using Detective least privilege rights to do their job, and a great way to start with this is by attaching the AWS IAM Managed Policy AmazonDetectiveInvestigatorAccess to your incident responder’s IAM Role. You can view this policy, and others, on the Settings &gt; General tab.</p>
<p><img alt="Detective IAM policies" src="../../images/DT-IAM-Policies.png" /></p>
<p><em>Figure 8: Detective IAM policies</em></p>
<h3 id="investigating-a-finding">Investigating a Finding</h3>
<p>There are four primary ways to start an investigation using Detective. We'll cover these methods in detail below.</p>
<ol>
<li>Using the <strong>Investigate with Detective</strong> option from GuardDuty</li>
<li>Examining a <strong>Finding Group</strong> in Detective</li>
<li>Threat hunting using Detective's Search and geography graphs</li>
<li>Using embedded links in Splunk</li>
</ol>
<h4 id="start-your-investigation-from-guardduty">Start your investigation from GuardDuty</h4>
<p>Most customers start investigations after a threat has been detected through Amazon GuardDuty, using the <strong>Investigate with Detective</strong> option on the Finding. If you don't have any GuardDuty findings present, you can still use Detective to investigate activity or threat hunt, as we’ll explain in method #3 below. When you open a GuardDuty finding, a detail pane will appear on the right. Click the <strong>Investigate with Detective</strong> option.</p>
<p><img alt="GuardDuty finding" src="../../images/DT-GD-Finding.png" /></p>
<p><em>Figure 9: Investigation link in GuardDuty finding detail page</em></p>
<p>You’ll see a panel with all the related resources collected by Detective. Let’s start with the GuardDuty finding.</p>
<p><img alt="Detective investigation options" src="../../images/DT-Investigate-Options.png" /></p>
<p><em>Figure 10: Detective investigation options from GuardDuty finding</em></p>
<p>From here we can see the VPC ID, the subnet ID, and other related information.</p>
<p><img alt="Detective entities" src="../../images/DT-Entities.png" /></p>
<p><em>Figure 11: Entities related to GuardDuty Finding</em></p>
<p>Let’s browse into the EC2 instance and see the related information.</p>
<p><img alt="Detective EC2 Instance" src="../../images/DT-Instance.png" /></p>
<p><em>Figure 12: Instance profile page in Detective</em></p>
<p>From here you will be able to determine when the EC2 was built, the AWS Account it resides in, the IAM Role or User that created the EC2 instance.</p>
<p>If we click into the Created By IAM Role, we can look at the Resource Interaction tab, identify the IAM identity that created this EC2 instance, when the first observance of the user was, the most recent occurrence, and the various times this user has assumed this role during the scope time.</p>
<p><img alt="Detective Role" src="../../images/DT-Role.png" /></p>
<p><em>Figure 13: Role profile page in Detective</em></p>
<p>For the sake of this walkthrough let’s assume you have noticed a strange occurence with the role assumptions of the user in question. With that in mind at this point you may want to execute your incident response plan, isolate and snapshot the EC2 instance, revoke credentials for past sessions on the IAM Role, and further investigate the federated user who created the instance. If your organization does not currently have incident response playbooks, there are <a href="https://github.com/aws-samples/aws-incident-response-playbooks">publicly available samples</a> to help you get started.</p>
<h4 id="start-your-investigation-from-a-finding-groups">Start your investigation from a Finding Groups</h4>
<p>Amazon Detective Finding Groups enable you to examine multiple activities as they relate to a single security event. If a threat actor is attempting to compromise your AWS environment, they typically perform a sequence of actions that lead to multiple security findings and unusual behaviors. These actions are often spread across time and entities. When security findings are investigated in isolation, it can lead to a misinterpretation of their significance and difficulty in finding the root cause. Amazon Detective addresses this problem by applying a graph analysis technique that infers relationships between findings and entities, and groups them together. We recommend treating Finding Groups as the starting point for investigating the involved entities and findings. While GuardDuty can show you the threat event, Detective can tell you the story of what else happened in the environment related to the event.</p>
<p>When we first navigate to a Finding Group (example image below), we can see that we are presented with a generative AI powered summary of the Finding Group. This gives us an understanding of the activity associated with the Finding Group before we even dive into the data.</p>
<p><img alt="Detective Gen AI" src="../../images/DT-Gen-AI.png" />
<em>Figure 14: Detective generative AI Finding Group summary</em></p>
<p>Detective will attempt to correlate threat events and resources to the MITRE ATT&amp;CK framework. <a href="https://attack.mitre.org/matrices/enterprise/">MITRE</a> publishes a matrix of Tactics, Techniques and Procedures (TTPs) that malicious actors perform when attacking a system. These correlated TTPs are published by Detective into a Finding Group. This is a visual representation of the events, resources, and security findings that make up an event.</p>
<p><img alt="Detective Finding Group TTPs" src="../../images/DT-Finding-TTPs.png" /></p>
<p><em>Figure 15: TTPs associated with Detective Finding Group</em></p>
<p>The Finding Group is represented by this generated graph that provides a visualization of associated resources and how they are connected. In this example, there are many different IP addresses associated with a brute force GuardDuty finding, and some of these resources are associated with other GuardDuty findings, like this Domain Generation Algorithm (DGA) request. DGAs are used to periodically generate a large number of domain names that can be used as rendezvous points with their command and control (C&amp;C) servers. During a GuardDuty finding investigation, it might not be clear that there are other resources included in the overall security issue. Detective Finding Groups help connect these dots.</p>
<p><img alt="Detective Finding Group graph" src="../../images/DT-Graph.png" /></p>
<p><em>Figure 16: Detective Finding Group graph visualization</em></p>
<p>Use these Finding Groups to investigate other IPs, EC2s, or AWS accounts from where an attack originated or continued onto.</p>
<p>The data correlating events to resources is available in raw data if you are collecting these data sources individually, but security analysts need to know how to craft individual queries to crawl through logs and then graph to a visualization tool later. Detective short-circuits this investigative effort and query generation activity. While most customers don’t replace their traditional SIEM tools with Detective, the use of Detective with a SIEM is effective at reducing investigation times.</p>
<p>Compare Detective's effectiveness to collecting and aggregating your logs separately. If you are collecting data sources individually and storing in a log aggregation tool, your security analysts will need the expertise to craft queries to find the data they need, and graph to a visualization tool separately. Detective short-circuits this alert --&gt; log --&gt; query --&gt; visualize process by providing you a visualization using built-in AWS data feeds. While most customers don’t replace their traditional SIEM tools with Detective, the use of Detective with a SIEM is effective at reducing investigation times.</p>
<h4 id="threat-hunting-in-detective">Threat Hunting in Detective</h4>
<p>Customers can use Detective if they have interesting information that they want to try to correlate to AWS resources or events. Commonly, Detective is used to investigate where your AWS resources are communicating with suspicious public IPs. Browse to Amazon Detective console, on the left navigation pane click the Search option. You can search for many kinds of resources including EC2 instances, IP addresses, Kubernetes Subjects, or Container Images.</p>
<p><img alt="Detective search options" src="../../images/DT-Search-Options.png" /></p>
<p><em>Figure 17: Detective search options</em></p>
<p><img alt="Detective IP search" src="../../images/DT-Search-IP.png" /></p>
<p><em>Figure 18: Searching for IP in Detective</em></p>
<p>Important Note: With regards to IP addresses, it’s important to remember which IPs are yours vs public IPs. Most customer IPv4 addresses are in the RFC1918 range (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16). If you are using public IPs in your IP schema for your VPCs, you may need to perform lookups occasionally to determine who owns the IP.</p>
<p>In addition to searching for information <a href="https://docs.aws.amazon.com/detective/latest/userguide/detective-investigations.html">Detective Investigations</a> lets you investigate IAM users and IAM roles using Indicators of Compromise (IoC). IoCs can help you determine if a resource is involved in a security incident. Detective investigations enables you to investigate attack tactics including <a href="https://www.mimecast.com/blog/impossible-travel-tests-limits-of-anomalous-detection/">impossible travel</a>, ﬂagged IP addresses, and Finding Groups. It performs initial security investigation steps and generates a report highlighting the risks identified by Detective to help you understand security events and respond.</p>
<p>To start an investigation, select <strong>Run Investigation</strong>. Choose your desired date/time and confirm.</p>
<p><img alt="Detective Start investigation" src="../../images/DT-Start-Investigation.png" />
<em>Figure 19: Start investigation button on IAM role entity page</em></p>
<p><img alt="Detective confirm investigation" src="../../images/DT-Confirm-Investigation.png" />
<em>Figure 20: Confirm investigation settings</em></p>
<p>Once the investigation has run, new information will be available including TTPs, threat intelligence flagged IP addresses, impossible travel, related Finding Groups, related findings, new geolocations, new user agents, and new ASOs. All information will be provided in the console and can be downloaded in a JSON format.</p>
<p><img alt="Detective investigation results" src="../../images/DT-Investigation-Results.png" />
<em>Figure 21: Detective sample investigation results</em></p>
<h4 id="crafting-detective-embedded-urls">Crafting Detective Embedded URLs</h4>
<p>The fourth way to start investigating a security event with Detective is to use embedded links in Splunk through the Splunk Trumpet project. The Splunk Trumpet project allows you send data from AWS services to Splunk. You can configure the Trumpet project to generate Detective URLs for Amazon GuardDuty findings. You can then use these URLs to pivot directly from Splunk to the corresponding Detective finding profiles. The Trumpet project is available from <a href="https://github.com/splunk/splunk-aws-project-trumpet">GitHub</a>.</p>
<p><img alt="Detective URLs" src="../../images/DT-URLs.png" /></p>
<p><em>Figure 22: Crafting Detective embedded URLs</em></p>
<h2 id="cost-considerations">Cost Considerations</h2>
<p>Amazon Detective pricing is thoroughly covered in the <a href="https://aws.amazon.com/detective/pricing/">pricing page</a>, including dimensions used for pricing and some pricing examples. In this guide, we'll cover some options to control your Detective spend.</p>
<ol>
<li>Take advantage of the 30-day free trial to get an idea of how pricing works with Detective. After enabling Detective, come back in a few days and check the Usage tab on the left.</li>
<li>In the Detective usage page you can view the estimated costs under the <strong>This account’s projected costs</strong> and <strong>All accounts’ projected costs</strong>. You can further understand which accounts are driving costs by using the <strong>Ingested volume by member account</strong> option.</li>
<li>Some customers choose to exclude AWS accounts that are classified as sandbox or non-production as a way to control their cost. Also consider if you have supplementary tools that ingest VPC Flow Logs and AWS CloudTrail data separately that could be scaled down and augmented with Detective.</li>
</ol>
<p><img alt="Detective usage page" src="../../images/DT-Usage.png" /></p>
<p><em>Figure 23: Detective usage page</em></p>
<h2 id="resources">Resources</h2>
<h3 id="workshops">Workshops</h3>
<ul>
<li><a href="https://awsactivationdays.splashthat.com/">Activation Days</a></li>
<li><a href="https://catalog.workshops.aws/guardduty">Amazon GuardDuty workshop</a></li>
<li><a href="https://catalog.workshops.aws/detective">Amazon Detective workshop</a></li>
<li><a href="https://catalog.workshops.aws/containersecurity">EKS security workshop</a></li>
</ul>
<h3 id="videos">Videos</h3>
<ul>
<li><a href="https://www.youtube.com/watch?v=vd_VHg6-xWc&amp;t=1796s&amp;pp=ygUTcmVpbmZvcmNlIGRldGVjdGl2ZQ%3D%3D">AWS re:Inforce 2022 - Using Amazon Detective to improve security investigations(TDR302)</a></li>
<li><a href="https://www.youtube.com/watch?v=TWJtvq8pgw8&amp;t">AWS re:Inforce 2023 - Streamline security analysis with Amazon Detective (TDR210)</a></li>
<li><a href="https://www.youtube.com/watch?v=AtUZgdtZCYo">How to use Amazon Detective for security investigations</a></li>
<li><a href="https://www.youtube.com/watch?v=U5xu6Dy3Pb0&amp;list=PLhr1KZpdzukfJzNDd8eCJH_TGg24ZTwP6&amp;index=9&amp;pp=iAQB">Detective Finding Groups include Amazon Inspector findings</a>
<a href="https://www.youtube.com/watch?v=dFR4Dk4h1Go&amp;list=PLhr1KZpdzukfJzNDd8eCJH_TGg24ZTwP6&amp;index=15&amp;pp=iAQB">* Investigations for Amazon GuardDuty threat detections</a></li>
<li><a href="https://www.youtube.com/watch?v=nuYHzN02f60&amp;list=PLhr1KZpdzukfJzNDd8eCJH_TGg24ZTwP6&amp;index=31&amp;pp=iAQB">Using Amazon Detective to perform root cause analysis for security findings</a></li>
<li><a href="https://www.youtube.com/watch?v=TZZuQrC8ZtA&amp;list=PLhr1KZpdzukfJzNDd8eCJH_TGg24ZTwP6&amp;index=43&amp;pp=iAQB">Amazon Detective Visualizations demo</a></li>
<li><a href="https://www.youtube.com/watch?v=rPnpPBIRRv8&amp;list=PLhr1KZpdzukfJzNDd8eCJH_TGg24ZTwP6&amp;index=63&amp;pp=iAQB">Reduce time to investigate GuardDuty findings by grouping related findings</a></li>
<li><a href="https://www.youtube.com/watch?v=Rz8MvzPfTZA&amp;list=PLhr1KZpdzukfJzNDd8eCJH_TGg24ZTwP6&amp;index=85&amp;pp=iAQB">Security Scenario investigation walk through</a></li>
<li><a href="https://www.youtube.com/watch?v=aZRnzBErRsE&amp;list=PLhr1KZpdzukfJzNDd8eCJH_TGg24ZTwP6&amp;index=88&amp;t=1s&amp;pp=iAQB">Deploying Amazon Detective with AWS Organizations</a></li>
</ul>
<h3 id="blogs">Blogs</h3>
<ul>
<li><a href="https://aws.amazon.com/blogs/security/how-to-improve-security-incident-investigations-using-amazon-detective-finding-groups/">How to improve security incident investigations using Amazon Detective Finding Groups</a></li>
<li><a href="https://aws.amazon.com/blogs/security/improve-your-security-investigations-with-detective-finding-groups-visualizations/">Improve your security investigations with Detective Finding Groups visualizations</a></li>
<li><a href="https://aws.amazon.com/blogs/security/how-to-detect-security-issues-in-amazon-eks-clusters-using-amazon-guardduty-part-1/">How to detect security issues in Amazon EKS clusters using Amazon GuardDuty – Part 1</a></li>
<li><a href="https://aws.amazon.com/blogs/security/how-to-investigate-and-take-action-on-security-issues-in-amazon-eks-clusters-with-amazon-detective-part-2/">How to detect security issues in Amazon EKS clusters using Amazon GuardDuty – Part 2</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; Amazon 2023
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["tabs", "content.code.copy", "announce.dismiss", "header.autohide"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>